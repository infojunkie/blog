<!DOCTYPE html>
<html lang="en">

  <head>
  <style>
    .no-js {
      visibility: visible !important;
    }
  </style>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Uploading Zoom meeting recordings to AWS S3</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.karimratib.me/2021/08/15/zoom-recording-upload.html">
  <link rel="alternate" type="application/rss+xml" title="infojunkie" href="/feed.xml">

  <link rel="shortcut icon" href="/favicon.ico">

  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Uploading Zoom meeting recordings to AWS S3 | infojunkie</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Uploading Zoom meeting recordings to AWS S3" />
<meta name="author" content="Karim Ratib" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="While helping out my friends at Labyrinth Online set up their platform for online music courses, I had the opportunity to work on an interesting function to automate the upload of recorded meetings from Zoom to AWS S3." />
<meta property="og:description" content="While helping out my friends at Labyrinth Online set up their platform for online music courses, I had the opportunity to work on an interesting function to automate the upload of recorded meetings from Zoom to AWS S3." />
<link rel="canonical" href="https://blog.karimratib.me/2021/08/15/zoom-recording-upload.html" />
<meta property="og:url" content="https://blog.karimratib.me/2021/08/15/zoom-recording-upload.html" />
<meta property="og:site_name" content="infojunkie" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-15T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Uploading Zoom meeting recordings to AWS S3" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Karim Ratib"},"dateModified":"2021-08-15T00:00:00-07:00","datePublished":"2021-08-15T00:00:00-07:00","description":"While helping out my friends at Labyrinth Online set up their platform for online music courses, I had the opportunity to work on an interesting function to automate the upload of recorded meetings from Zoom to AWS S3.","headline":"Uploading Zoom meeting recordings to AWS S3","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.karimratib.me/2021/08/15/zoom-recording-upload.html"},"url":"https://blog.karimratib.me/2021/08/15/zoom-recording-upload.html"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body style="visibility: hidden;" class="no-js">
    <script>
      // FOUC handling
      // https://www.primative.net/blog/how-to-get-rid-of-the-flash-of-unstyled-content/
      const domReady = (cb) => {
        document.readyState === 'interactive' || document.readyState === 'complete'
          ? cb()
          : document.addEventListener('DOMContentLoaded', cb);
      };
      domReady(() => {
        // Display body when DOM is loaded
        document.body.style.visibility = 'visible';
      });

      // If JS is disabled, "no-js" class causes body to be visible from the beginning.
      // If JS is enabled, remove the "no-js" class will force-hide the body until the above kicks in.
      document.querySelector('body').classList.remove('no-js');
    </script>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">
      
        infojunkie
      
    </a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/about/">about</a>
            
          
            
            
            <a class="page-link" href="/drupal.html">drupal</a>
            
          
            
            
            <a class="page-link" href="/demos/">music</a>
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Uploading Zoom meeting recordings to AWS S3</h1>
    <p class="post-meta">
      <time datetime="2021-08-15T00:00:00-07:00" itemprop="datePublished">
        
        Aug 15, 2021
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>While helping out my friends at <a href="https://labyrinthonline.org/" rel="noopener noreferrer" target="_blank">Labyrinth Online</a> set up their platform for online music courses, I had the opportunity to work on an interesting function to automate the upload of recorded meetings from Zoom to AWS S3.</p>

<!--more-->

<div class="flex-center">
  <figure class="image">
    <a href="https://labyrinthonline.org" rel="noopener noreferrer" target="_blank">
      <img src="/assets/labyrinth-online.png" style="max-width: 100%;" alt="Labyrinth Online is a music school offering live online classes for modal music, encompassing musical traditions of the Mediterranean and the Near East.">
    </a>
    <figcaption>Labyrinth Online is a music school offering live online classes for modal music, encompassing musical traditions of the Mediterranean and the Near East.</figcaption>
  </figure>
</div>

<p>Conceptually, the function couldn’t be simpler: Receive a webhook call from Zoom that a meeting’s recordings are available, and move all the video files therein to a specific AWS S3 bucket folder, with a specific filename pattern. But the proverbial devil lurked in the details, and I think the end result warrants a short description of the solution.</p>

<h1 id="first-attempt-zapier"><a class="header" href="#first-attempt-zapier">First attempt: Zapier</a></h1>
<p>I don’t like to write new code if I can avoid it, because it becomes a maintenance burden in the future. So I tried to use <a href="https://zapier.com/" rel="noopener noreferrer" target="_blank">Zapier</a> to implement the upload functionality. Zapier provides both a Zoom “New Recording” trigger and an AWS S3 “Upload File” action, so it seems I was set!</p>

<div class="flex-center">
  <figure class="image">
    <a href="/assets/meme-there-are-no-bugs-if-you-dont-write-any-code.jpg">
      <img src="/assets/meme-there-are-no-bugs-if-you-dont-write-any-code.jpg" style="max-width: 100%;" alt="">
    </a>
    <figcaption></figcaption>
  </figure>
</div>

<p>Unfortunately, the shape of the payload received by the Zoom trigger was too complex to be hooked into the AWS S3 upload function. For example:</p>
<ul>
  <li>The recording event payload contains an array of files of different types (video, audio, text transcript), instead of just one video file. It would be necessary to add <a href="https://zapier.com/apps/formatter/help" rel="noopener noreferrer" target="_blank">intermediate Zapier steps</a> to iterate and filter through the incoming array, with code conditions to be written in the Web-based Zapier UI which is not designed for this kind of complexity.</li>
  <li>Also, generating the correct filename (as needed for downstream processing on the course platform) also proved to be a challenge in this low-code environment.</li>
  <li>Finally, a JSON Web Token is needed to access the file recordings, which Zapier does not support short of generating a “forever” token and storing it in the zap’s action settings. This presents security and maintenance issues that I preferred to avoid.</li>
</ul>

<h1 id="moving-to-aws-lambda"><a class="header" href="#moving-to-aws-lambda">Moving to AWS Lambda</a></h1>
<p>I regretfully abandoned the Zapier approach, and decided to bite the bullet and write new code to perform my function. For deployment simplicity, I chose to write it using the <a href="https://www.serverless.com/" rel="noopener noreferrer" target="_blank">serverless Node.js framework</a> and to host it on AWS Lambda.</p>

<p>The Zoom API provides webhook notifications about events in a Zoom account. To setup a webhook integration, I created a Zoom Marketplace app of type JWT (JSON Web Token) and added to it an event subscription for the <a href="https://developers.zoom.us/docs/api/rest/reference/zoom-api/events/#operation/recording.completed" rel="noopener noreferrer" target="_blank">Recording Completed event</a>. Each event subscription accepts a single webhook endpoint, which is the URL of the AWS Lambda HTTP endpoint.</p>

<p>The plan of the function is thus:</p>
<ul>
  <li>Upon reception of the webhook:</li>
  <li>Don’t continue unless it’s a legitimate course meeting</li>
  <li>Select the eligible video files to be uploaded</li>
  <li>Create the appropriate video folder in a configured AWS S3 bucket</li>
  <li>For each video file:</li>
  <li>Generate a short-lived JWT for the Zoom file download</li>
  <li>Generate a filename for the S3 file upload</li>
  <li>Download the file from Zoom and upload to S3, without creating an intermediate file in the Lambda environment</li>
</ul>

<h1 id="second-attempt-single-function"><a class="header" href="#second-attempt-single-function">Second attempt: Single function</a></h1>
<p>My next attempt was to implement the outline above in a single function that loops over the video files and uploads them sequentially. I was very proud of writing a streaming file download/upload loop that does not need intermediate storage, as follows:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="nf">uploadZoomToS3</span><span class="p">(</span><span class="nx">zoomDownloadUrl</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">zoomToken</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">generateZoomToken</span><span class="p">();</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">fetch</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">zoomDownloadUrl</span><span class="p">}</span><span class="s2">?access_token=</span><span class="p">${</span><span class="nx">zoomToken</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">redirect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">follow</span><span class="dl">'</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">s3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nc">S3</span><span class="p">();</span>
      <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">s3</span><span class="p">.</span><span class="nf">putObject</span><span class="p">({</span>
        <span class="na">Bucket</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="dl">'</span><span class="s1">DESTINATION_BUCKET</span><span class="dl">'</span><span class="p">],</span>
        <span class="na">Key</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">prefix</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">fileName</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
        <span class="na">Body</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
        <span class="na">ContentType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">video/mp4</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">ContentLength</span><span class="p">:</span> <span class="nx">size</span> <span class="o">||</span> <span class="nc">Number</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-length</span><span class="dl">'</span><span class="p">))</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">request</span><span class="p">.</span><span class="nf">promise</span><span class="p">();</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Successfully uploaded </span><span class="p">${</span><span class="nx">fileName</span><span class="p">}</span><span class="s2"> to </span><span class="p">${</span><span class="nx">prefix</span><span class="p">}</span><span class="s2">.`</span><span class="p">);</span>
      <span class="nf">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In retrospect, how naive I was! I soon noticed that most of the files never made it to S3, and that some of the files made it in multiple copies. What was going on? After debugging, it turned out that Zoom was calling my function multiple times for the same meeting, which was definitely not what I expected. After yet more debugging, I found the cause: <a href="https://marketplace.zoom.us/docs/api-reference/webhook-reference#notification-delivery" rel="noopener noreferrer" target="_blank">Zoom was expecting an answer from my function within 3 seconds</a>, but my function took more time to upload the full files. Zoom then proceeded to retry the call according to its retry policy. My life was shattered for a few minutes.</p>

<div class="flex-center">
  <figure class="image">
    <a href="/assets/meme-two-states-of-every-programmer.png">
      <img src="/assets/meme-two-states-of-every-programmer.png" style="max-width: 100%;" alt="">
    </a>
    <figcaption></figcaption>
  </figure>
</div>

<h1 id="final-attempt-async-to-the-rescue"><a class="header" href="#final-attempt-async-to-the-rescue">Final attempt: Async to the rescue!</a></h1>
<p>After more research into what seemed to be a common problem, I found that <a href="https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html" rel="noopener noreferrer" target="_blank">Lambda functions can be called asynchronously</a> - but only if they are not wired to an HTTP endpoint (which does make sense). I decided to split the function into two: one function that receives the Zoom webhook call, loops over the recorded files and invokes a second, async function that performs the actual upload.</p>

<p>It was relatively painless to create this setup, barring a couple of details:</p>
<ul>
  <li>One needs to call <code class="language-plaintext highlighter-rouge">AWS.Lambda.invoke()</code> with <code class="language-plaintext highlighter-rouge">{ InvocationType: 'Event' }</code> for the call to be made asynchronously.</li>
  <li>The file <code class="language-plaintext highlighter-rouge">serverless.yml</code> needs the permission for the <code class="language-plaintext highlighter-rouge">lambda:InvokeFunction</code> action.</li>
</ul>

<p>Since deployment in May 2021, this system has handled thousands of video files without issue <img class="emoji" title=":tada:" alt=":tada:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f389.png" height="20" width="20"></p>

<p>Here’s the full listing of the relevant code - note that I extracted and simplified it from its original context and did not test it further, so some assembly may be required. Enjoy!</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># serverless.yml</span>
<span class="c1">#</span>
<span class="na">service</span><span class="pi">:</span> <span class="s">labyrinth-service</span>

<span class="na">provider</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">aws</span>
  <span class="na">iamManagedPolicies</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"</span>
  <span class="na">iamRoleStatements</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">Effect</span><span class="pi">:</span> <span class="s">Allow</span>
      <span class="na">Action</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">lambda:InvokeFunction</span>
      <span class="na">Resource</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>

<span class="na">functions</span><span class="pi">:</span>
  <span class="c1"># Responsible for receiving Zoom webhook and invoking ZoomUploadAsync</span>
  <span class="na">zoomUpload</span><span class="pi">:</span>
    <span class="na">handler</span><span class="pi">:</span> <span class="s">zoomUpload.handler</span>
    <span class="na">events</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">http</span><span class="pi">:</span>
          <span class="na">path</span><span class="pi">:</span> <span class="s">/media/zoom</span>
          <span class="na">method</span><span class="pi">:</span> <span class="s">post</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">STAGE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${self:custom.stage}"</span>
      <span class="na">REGION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${self:custom.region}"</span>

  <span class="c1"># Responsible for uploading Zoom video to watch bucket</span>
  <span class="na">zoomUploadAsync</span><span class="pi">:</span>
    <span class="na">handler</span><span class="pi">:</span> <span class="s">zoomUploadAsync.handler</span>
    <span class="na">timeout</span><span class="pi">:</span> <span class="m">120</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">DESTINATION_BUCKET</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${self:custom.uploadBucketName}"</span>
      <span class="na">ZOOM_API_KEY</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${self:custom.secretParams.ZOOM_API_KEY}"</span>
      <span class="na">ZOOM_API_SECRET</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${self:custom.secretParams.ZOOM_API_SECRET}"</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// zoomUpload.js</span>
<span class="c1">//</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">phScript</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ZoomUpload</span><span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">context</span> <span class="p">});</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">phScript</span><span class="p">.</span><span class="nf">main</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">aws-sdk</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">_</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">lodash</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">inspect</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">class</span> <span class="nc">ZoomUpload</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">props</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_event</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">body</span><span class="o">||</span><span class="dl">'</span><span class="s1">{}</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// TODO Verify Zoom `authorization` header as per https://marketplace.zoom.us/docs/api-reference/webhook-reference#headers</span>
    <span class="k">if </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">.</span><span class="nx">event</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">recording.completed</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">warn</span><span class="p">(</span><span class="s2">`Received Zoom event </span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">.</span><span class="nx">event</span><span class="p">}</span><span class="s2">. Ignoring.`</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getCourseCode</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">warn</span><span class="p">(</span><span class="s2">`Could not find course code in meeting "</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">topic</span><span class="p">}</span><span class="s2">". Ignoring.`</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">videos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getVideoFiles</span><span class="p">();</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">videos</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">warn</span><span class="p">(</span><span class="s2">`Could not find any eligible video in meeting "</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">topic</span><span class="p">}</span><span class="s2">". Ignoring.`</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="s2">`labyrinth-service-</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="dl">'</span><span class="s1">STAGE</span><span class="dl">'</span><span class="p">]}</span><span class="s2">-zoomUploadAsync`</span><span class="p">;</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">video</span> <span class="k">of</span> <span class="nx">videos</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">invokeLambda</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">video</span><span class="p">,</span> <span class="nx">code</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`Error occurred while invoking upload function </span><span class="p">${</span><span class="nx">fn</span><span class="p">}</span><span class="s2"> for meeting "</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">topic</span><span class="p">}</span><span class="s2">": </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">invokeLambda</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">video</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">lambda</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nc">Lambda</span><span class="p">({</span> <span class="na">region</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="dl">'</span><span class="s1">REGION</span><span class="dl">'</span><span class="p">]</span> <span class="p">});</span>
      <span class="nx">lambda</span><span class="p">.</span><span class="nf">invoke</span><span class="p">({</span> <span class="na">FunctionName</span><span class="p">:</span> <span class="nx">fn</span><span class="p">,</span> <span class="na">InvocationType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Event</span><span class="dl">'</span><span class="p">,</span> <span class="na">Payload</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">({</span>
        <span class="na">topic</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">topic</span><span class="p">,</span>
        <span class="nx">code</span><span class="p">,</span>
        <span class="nx">video</span>
      <span class="p">})},</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nf">resolve</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Detect if this is a course meeting having a [code123] substring.</span>
  <span class="nf">getCourseCode</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">,</span> <span class="dl">'</span><span class="s1">payload.object.topic</span><span class="dl">'</span><span class="p">,</span> <span class="dl">''</span><span class="p">).</span><span class="nf">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\[(\w</span><span class="sr">+</span><span class="se">)\]</span><span class="sr">/</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">code</span> <span class="o">&amp;&amp;</span> <span class="nx">code</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="c1">// Detect video files that we want to upload.</span>
  <span class="nf">getVideoFiles</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_data</span><span class="p">,</span> <span class="dl">'</span><span class="s1">payload.object.recording_files</span><span class="dl">'</span><span class="p">,</span> <span class="p">[]).</span><span class="nf">filter</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">recording_start</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">recording_end</span><span class="p">);</span>
      <span class="c1">// Return mp4 videos with running time &gt;= 2min</span>
      <span class="k">return</span> <span class="nx">file</span><span class="p">.</span><span class="nx">file_type</span><span class="p">.</span><span class="nf">toUpperCase</span><span class="p">()</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">MP4</span><span class="dl">"</span>
          <span class="o">&amp;&amp;</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">2</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// zoomUploadAsync.js</span>
<span class="c1">//</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">phScript</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ZoomUploadAsync</span><span class="p">({</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">context</span> <span class="p">});</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">phScript</span><span class="p">.</span><span class="nf">main</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">fetch</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">jsonwebtoken</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">aws-sdk</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">_</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">lodash</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">inspect</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// https://stackoverflow.com/a/10075654/209184</span>
<span class="kd">function</span> <span class="nf">padDigits</span><span class="p">(</span><span class="nx">number</span><span class="p">,</span> <span class="nx">digits</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">Array</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="nx">digits</span> <span class="o">-</span> <span class="nc">String</span><span class="p">(</span><span class="nx">number</span><span class="p">).</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)).</span><span class="nf">join</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nx">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">PREFIX</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">courses/uploads</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ZoomUploadAsync</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">props</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_event</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">video</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">video</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nf">uploadZoomToS3</span><span class="p">(</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">download_url</span><span class="p">,</span>
        <span class="nx">video</span><span class="p">.</span><span class="nx">file_size</span><span class="p">,</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">recordingTofilename</span><span class="p">(),</span>
        <span class="s2">`</span><span class="p">${</span><span class="nx">PREFIX</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">code</span><span class="p">}</span><span class="s2">`</span>
      <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">`Error occurred while uploading video at </span><span class="p">${</span><span class="nx">video</span><span class="p">.</span><span class="nx">play_url</span><span class="p">}</span><span class="s2"> for meeting "</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">topic</span><span class="p">}</span><span class="s2">": </span><span class="p">${</span><span class="nx">error</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nf">uploadZoomToS3</span><span class="p">(</span><span class="nx">zoomDownloadUrl</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">zoomToken</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">generateZoomToken</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">fetch</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">zoomDownloadUrl</span><span class="p">}</span><span class="s2">?access_token=</span><span class="p">${</span><span class="nx">zoomToken</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">redirect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">follow</span><span class="dl">'</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">s3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nc">S3</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">s3</span><span class="p">.</span><span class="nf">putObject</span><span class="p">({</span>
          <span class="na">Bucket</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="dl">'</span><span class="s1">DESTINATION_BUCKET</span><span class="dl">'</span><span class="p">],</span>
          <span class="na">Key</span><span class="p">:</span> <span class="s2">`</span><span class="p">${</span><span class="nx">prefix</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">fileName</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
          <span class="na">Body</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
          <span class="na">ContentType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">video/mp4</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">ContentLength</span><span class="p">:</span> <span class="nx">size</span> <span class="o">||</span> <span class="nc">Number</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-length</span><span class="dl">'</span><span class="p">))</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">request</span><span class="p">.</span><span class="nf">promise</span><span class="p">();</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Successfully uploaded </span><span class="p">${</span><span class="nx">fileName</span><span class="p">}</span><span class="s2"> to </span><span class="p">${</span><span class="nx">prefix</span><span class="p">}</span><span class="s2">.`</span><span class="p">);</span>
        <span class="nf">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nf">generateZoomToken</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">zoomPayload</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">iss</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="dl">'</span><span class="s1">ZOOM_API_KEY</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">exp</span><span class="p">:</span> <span class="p">((</span><span class="k">new</span> <span class="nc">Date</span><span class="p">()).</span><span class="nf">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5000</span><span class="p">)</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">jwt</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">zoomPayload</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="dl">'</span><span class="s1">ZOOM_API_SECRET</span><span class="dl">'</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="nf">recordingTofilename</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// GMT20210429_165119_Recording.mp4</span>
    <span class="kd">const</span> <span class="nx">video</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_event</span><span class="p">.</span><span class="nx">video</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">video</span><span class="p">.</span><span class="nx">recording_start</span><span class="p">);</span>
    <span class="k">return</span> <span class="dl">'</span><span class="s1">GMT</span><span class="dl">'</span> <span class="o">+</span>
           <span class="nx">date</span><span class="p">.</span><span class="nf">getUTCFullYear</span><span class="p">()</span> <span class="o">+</span>
           <span class="nf">padDigits</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nf">getUTCMonth</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
           <span class="nf">padDigits</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nf">getUTCDate</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
           <span class="dl">'</span><span class="s1">_</span><span class="dl">'</span> <span class="o">+</span>
           <span class="nf">padDigits</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nf">getUTCHours</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
           <span class="nf">padDigits</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nf">getUTCMinutes</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
           <span class="nf">padDigits</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nf">getUTCSeconds</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
           <span class="dl">'</span><span class="s1">_Recording.mp4</span><span class="dl">'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

  </div>

  

  
    
<script data-isso="https://blog.karimratib.me/isso" src="https://blog.karimratib.me/isso/js/embed.min.js"></script>
<section id="isso-thread"></section>


  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">infojunkie</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            <a href="/assets/CV-KarimRATIB.pdf">
              my resume
            </a>
          </li>
          <li>
            <a href="https://github.com/infojunkie/blog" rel="noopener noreferrer" target="_blank">
              blog source
            </a>
          </li>
        </ul>

        <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>

      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://thereisamoduleforthat.com" rel="noopener noreferrer" target="_blank">
              <img src="/assets/tmft.svg">
              There's a module for that!
            </a>
          </li>
          <li>
            <a href="https://github.com/infojunkie" rel="noopener noreferrer" target="_blank">
              <svg class="icon"><use xlink:href="#fab.fa-github"></use></svg>
              GitHub
            </a>
          </li>
          <li>
            <a href="https://www.youtube.com/@KarimRatib" rel="noopener noreferrer" target="_blank">
              <svg class="icon"><use xlink:href="#fab.fa-youtube"></use></svg>
              YouTube
            </a>
          </li>
          <li>
            <a href="https://musescore.com/infojunkie" rel="noopener noreferrer" target="_blank">
              <svg class="icon"><use xlink:href="#fas.fa-music"></use></svg>
              Musescore
            </a>
          </li>
          <li>
            <a href="mailto:karim.ratib@gmail.com">
              <svg class="icon"><use xlink:href="#far.fa-envelope"></use></svg>
              email
            </a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
      </div>
    </div>

    <div class="footer-col">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>

  </div>

  <svg display="none" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <defs>
                  <!--
                  Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
                  License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
                  -->
              <symbol id="fab.fa-github" viewbox="0 0 496 512">
            <title>github</title>
            <path class="path1" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
        </symbol>
        <symbol id="fab.fa-youtube" viewbox="0 0 576 512">
            <title>youtube</title>
            <path class="path1" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path>
        </symbol>
        <symbol id="fas.fa-music" viewbox="0 0 512 512">
            <title>music</title>
            <path class="path1" d="M499.1 6.3c8.1 6 12.9 15.6 12.9 25.7v72V368c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6V147L192 223.8V432c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6V200 128c0-14.1 9.3-26.6 22.8-30.7l320-96c9.7-2.9 20.2-1.1 28.3 5z"></path>
        </symbol>
        <symbol id="far.fa-envelope" viewbox="0 0 512 512">
            <title>envelope</title>
            <path class="path1" d="M64 112c-8.8 0-16 7.2-16 16v22.1L220.5 291.7c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16H64zM48 212.2V384c0 8.8 7.2 16 16 16H448c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64H448c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"></path>
        </symbol>
        </defs>
              </svg>

</footer>


  </body>

</html>
