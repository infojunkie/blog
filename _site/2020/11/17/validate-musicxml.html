<!DOCTYPE html>
<html lang="en">

  <head>
  <style>
    .no-js {
      visibility: visible !important;
    }
  </style>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Validating MusicXML files without the tears</title>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.karimratib.me/2020/11/17/validate-musicxml.html">
  <link rel="alternate" type="application/rss+xml" title="infojunkie" href="/feed.xml">

  <link rel="shortcut icon" href="/favicon.ico">

  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0"></script>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Validating MusicXML files without the tears | infojunkie</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Validating MusicXML files without the tears" />
<meta name="author" content="Karim Ratib" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="MusicXML is a standard open format for exchanging digital sheet music, supported by a large number of music applications. Version 3.1 is the first version to be released by the W3C Music Notation Community Group. It’s a complex format, aiming at capturing both presentation and playback information for a piece of music. That makes it tricky to parse, and tricky to generate. This short note presents a recipe to easily validate MusicXML 3.1 files using open source tools. MusicXML validation on the console MusicXML ships with XSD and DTD files that describe the document structure. We can use the widely-supported tool xmllint (included in libxml2 on most platforms) to validate MusicXML files against the official XSD. As always, a bit of fiddling is needed to get things right :sweat_smile: First, download and extract the latest MusicXML package from W3C’s GitHub. Because the current XSD contains invalid xs:import links, it is necessary to apply a patch before proceeding with validation. The patch is very simple; you need to change: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;http://www.musicxml.org/xsd/xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;http://www.musicxml.org/xsd/xlink.xsd&quot;/&gt; to refer to correct locations, either w3.org: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;http://www.w3.org/2001/xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;http://www.w3.org/1999/xlink.xsd&quot;/&gt; or, since the MusicXML package ships with those files, simply: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;xlink.xsd&quot;/&gt; You are now ready to use xmllint to validate your MusicXML files: $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates $ xmllint --schema musicxml-3.1/schema/musicxml.xsd invalid.musicxml --noout invalid.musicxml:3: element score-partwise: Schemas validity error : Element &#39;score-partwise&#39;, attribute &#39;bad-attribute&#39;: The attribute &#39;bad-attribute&#39; is not allowed. invalid.musicxml fails to validate The difference between local and external links to xml.xsd and xlink.xsd is twofold: The time taken for validation is significant. For local files: $ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates real 0m0.043s user 0m0.038s sys 0m0.005s whereas for external files, it takes 15 seconds: $ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates real 0m15.478s user 0m0.038s sys 0m0.005s Secondly, in some environments, it may be necessary to run without an Internet connection, i.e xmllint --nonet. Here’s what happens in this case: $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet valid.musicxml validates versus $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet I/O error : Attempt to load network entity http://www.w3.org/2001/xml.xsd warning: failed to load external entity &quot;http://www.w3.org/2001/xml.xsd&quot; musicxml-3.1/schema/musicxml.xsd:24: element import: Schemas parser warning : Element &#39;{http://www.w3.org/2001/XMLSchema}import&#39;: Failed to locate a schema at location &#39;http://www.w3.org/2001/xml.xsd&#39;. Skipping the import. I/O error : Attempt to load network entity http://www.w3.org/1999/xlink.xsd warning: failed to load external entity &quot;http://www.w3.org/1999/xlink.xsd&quot; musicxml-3.1/schema/musicxml.xsd:25: element import: Schemas parser warning : Element &#39;{http://www.w3.org/2001/XMLSchema}import&#39;: Failed to locate a schema at location &#39;http://www.w3.org/1999/xlink.xsd&#39;. Skipping the import. [..] WXS schema musicxml-3.1/schema/musicxml.xsd failed to compile MusicXML validation programmatically If you application exports MusicXML files, it’s a good idea to validate them before processing, to avoid tripping your code or exporting invalid files. On my iReal Pro to MusicXML converter, I use the JavaScript module validate-with-xmllint in the tests to ensure that the converter module generates valid MusicXML. Since this needs to run at build time, and not on production, I only need to install xmllint on the CI server. But XSD validation is not enough to ensure that your generated XML is valid semantically. It is also necessary to ensure that the expected elements are present, and contain the right values. For this, you need to reach inside your generated XML and compare generated values with your expectations. The easiest and most maintainable way I’ve found for that is using XPath, the XML query language. For this, I use xmldom and xpath.js to validate the generated MusicXML files during the test phase. That’s it! Hope you find this useful :raised_hands:" />
<meta property="og:description" content="MusicXML is a standard open format for exchanging digital sheet music, supported by a large number of music applications. Version 3.1 is the first version to be released by the W3C Music Notation Community Group. It’s a complex format, aiming at capturing both presentation and playback information for a piece of music. That makes it tricky to parse, and tricky to generate. This short note presents a recipe to easily validate MusicXML 3.1 files using open source tools. MusicXML validation on the console MusicXML ships with XSD and DTD files that describe the document structure. We can use the widely-supported tool xmllint (included in libxml2 on most platforms) to validate MusicXML files against the official XSD. As always, a bit of fiddling is needed to get things right :sweat_smile: First, download and extract the latest MusicXML package from W3C’s GitHub. Because the current XSD contains invalid xs:import links, it is necessary to apply a patch before proceeding with validation. The patch is very simple; you need to change: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;http://www.musicxml.org/xsd/xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;http://www.musicxml.org/xsd/xlink.xsd&quot;/&gt; to refer to correct locations, either w3.org: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;http://www.w3.org/2001/xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;http://www.w3.org/1999/xlink.xsd&quot;/&gt; or, since the MusicXML package ships with those files, simply: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;xlink.xsd&quot;/&gt; You are now ready to use xmllint to validate your MusicXML files: $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates $ xmllint --schema musicxml-3.1/schema/musicxml.xsd invalid.musicxml --noout invalid.musicxml:3: element score-partwise: Schemas validity error : Element &#39;score-partwise&#39;, attribute &#39;bad-attribute&#39;: The attribute &#39;bad-attribute&#39; is not allowed. invalid.musicxml fails to validate The difference between local and external links to xml.xsd and xlink.xsd is twofold: The time taken for validation is significant. For local files: $ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates real 0m0.043s user 0m0.038s sys 0m0.005s whereas for external files, it takes 15 seconds: $ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates real 0m15.478s user 0m0.038s sys 0m0.005s Secondly, in some environments, it may be necessary to run without an Internet connection, i.e xmllint --nonet. Here’s what happens in this case: $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet valid.musicxml validates versus $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet I/O error : Attempt to load network entity http://www.w3.org/2001/xml.xsd warning: failed to load external entity &quot;http://www.w3.org/2001/xml.xsd&quot; musicxml-3.1/schema/musicxml.xsd:24: element import: Schemas parser warning : Element &#39;{http://www.w3.org/2001/XMLSchema}import&#39;: Failed to locate a schema at location &#39;http://www.w3.org/2001/xml.xsd&#39;. Skipping the import. I/O error : Attempt to load network entity http://www.w3.org/1999/xlink.xsd warning: failed to load external entity &quot;http://www.w3.org/1999/xlink.xsd&quot; musicxml-3.1/schema/musicxml.xsd:25: element import: Schemas parser warning : Element &#39;{http://www.w3.org/2001/XMLSchema}import&#39;: Failed to locate a schema at location &#39;http://www.w3.org/1999/xlink.xsd&#39;. Skipping the import. [..] WXS schema musicxml-3.1/schema/musicxml.xsd failed to compile MusicXML validation programmatically If you application exports MusicXML files, it’s a good idea to validate them before processing, to avoid tripping your code or exporting invalid files. On my iReal Pro to MusicXML converter, I use the JavaScript module validate-with-xmllint in the tests to ensure that the converter module generates valid MusicXML. Since this needs to run at build time, and not on production, I only need to install xmllint on the CI server. But XSD validation is not enough to ensure that your generated XML is valid semantically. It is also necessary to ensure that the expected elements are present, and contain the right values. For this, you need to reach inside your generated XML and compare generated values with your expectations. The easiest and most maintainable way I’ve found for that is using XPath, the XML query language. For this, I use xmldom and xpath.js to validate the generated MusicXML files during the test phase. That’s it! Hope you find this useful :raised_hands:" />
<link rel="canonical" href="https://blog.karimratib.me/2020/11/17/validate-musicxml.html" />
<meta property="og:url" content="https://blog.karimratib.me/2020/11/17/validate-musicxml.html" />
<meta property="og:site_name" content="infojunkie" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-17T00:00:00-08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Validating MusicXML files without the tears" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Karim Ratib"},"dateModified":"2020-11-17T00:00:00-08:00","datePublished":"2020-11-17T00:00:00-08:00","description":"MusicXML is a standard open format for exchanging digital sheet music, supported by a large number of music applications. Version 3.1 is the first version to be released by the W3C Music Notation Community Group. It’s a complex format, aiming at capturing both presentation and playback information for a piece of music. That makes it tricky to parse, and tricky to generate. This short note presents a recipe to easily validate MusicXML 3.1 files using open source tools. MusicXML validation on the console MusicXML ships with XSD and DTD files that describe the document structure. We can use the widely-supported tool xmllint (included in libxml2 on most platforms) to validate MusicXML files against the official XSD. As always, a bit of fiddling is needed to get things right :sweat_smile: First, download and extract the latest MusicXML package from W3C’s GitHub. Because the current XSD contains invalid xs:import links, it is necessary to apply a patch before proceeding with validation. The patch is very simple; you need to change: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;http://www.musicxml.org/xsd/xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;http://www.musicxml.org/xsd/xlink.xsd&quot;/&gt; to refer to correct locations, either w3.org: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;http://www.w3.org/2001/xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;http://www.w3.org/1999/xlink.xsd&quot;/&gt; or, since the MusicXML package ships with those files, simply: &lt;xs:import namespace=&quot;http://www.w3.org/XML/1998/namespace&quot; schemaLocation=&quot;xml.xsd&quot;/&gt; &lt;xs:import namespace=&quot;http://www.w3.org/1999/xlink&quot; schemaLocation=&quot;xlink.xsd&quot;/&gt; You are now ready to use xmllint to validate your MusicXML files: $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates $ xmllint --schema musicxml-3.1/schema/musicxml.xsd invalid.musicxml --noout invalid.musicxml:3: element score-partwise: Schemas validity error : Element &#39;score-partwise&#39;, attribute &#39;bad-attribute&#39;: The attribute &#39;bad-attribute&#39; is not allowed. invalid.musicxml fails to validate The difference between local and external links to xml.xsd and xlink.xsd is twofold: The time taken for validation is significant. For local files: $ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates real 0m0.043s user 0m0.038s sys 0m0.005s whereas for external files, it takes 15 seconds: $ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout valid.musicxml validates real 0m15.478s user 0m0.038s sys 0m0.005s Secondly, in some environments, it may be necessary to run without an Internet connection, i.e xmllint --nonet. Here’s what happens in this case: $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet valid.musicxml validates versus $ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet I/O error : Attempt to load network entity http://www.w3.org/2001/xml.xsd warning: failed to load external entity &quot;http://www.w3.org/2001/xml.xsd&quot; musicxml-3.1/schema/musicxml.xsd:24: element import: Schemas parser warning : Element &#39;{http://www.w3.org/2001/XMLSchema}import&#39;: Failed to locate a schema at location &#39;http://www.w3.org/2001/xml.xsd&#39;. Skipping the import. I/O error : Attempt to load network entity http://www.w3.org/1999/xlink.xsd warning: failed to load external entity &quot;http://www.w3.org/1999/xlink.xsd&quot; musicxml-3.1/schema/musicxml.xsd:25: element import: Schemas parser warning : Element &#39;{http://www.w3.org/2001/XMLSchema}import&#39;: Failed to locate a schema at location &#39;http://www.w3.org/1999/xlink.xsd&#39;. Skipping the import. [..] WXS schema musicxml-3.1/schema/musicxml.xsd failed to compile MusicXML validation programmatically If you application exports MusicXML files, it’s a good idea to validate them before processing, to avoid tripping your code or exporting invalid files. On my iReal Pro to MusicXML converter, I use the JavaScript module validate-with-xmllint in the tests to ensure that the converter module generates valid MusicXML. Since this needs to run at build time, and not on production, I only need to install xmllint on the CI server. But XSD validation is not enough to ensure that your generated XML is valid semantically. It is also necessary to ensure that the expected elements are present, and contain the right values. For this, you need to reach inside your generated XML and compare generated values with your expectations. The easiest and most maintainable way I’ve found for that is using XPath, the XML query language. For this, I use xmldom and xpath.js to validate the generated MusicXML files during the test phase. That’s it! Hope you find this useful :raised_hands:","headline":"Validating MusicXML files without the tears","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.karimratib.me/2020/11/17/validate-musicxml.html"},"url":"https://blog.karimratib.me/2020/11/17/validate-musicxml.html"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body style="visibility: hidden;" class="no-js">
    <script>
      // FOUC handling
      // https://www.primative.net/blog/how-to-get-rid-of-the-flash-of-unstyled-content/
      const domReady = (cb) => {
        document.readyState === 'interactive' || document.readyState === 'complete'
          ? cb()
          : document.addEventListener('DOMContentLoaded', cb);
      };
      domReady(() => {
        // Display body when DOM is loaded
        document.body.style.visibility = 'visible';
      });

      // If JS is disabled, "no-js" class causes body to be visible from the beginning.
      // If JS is enabled, remove the "no-js" class will force-hide the body until the above kicks in.
      document.querySelector('body').classList.remove('no-js');
    </script>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">
      
        infojunkie
      
    </a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/about/">about</a>
            
          
            
            
            <a class="page-link" href="/drupal.html">drupal</a>
            
          
            
            
            <a class="page-link" href="/demos/">music</a>
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Validating MusicXML files without the tears</h1>
    <p class="post-meta">
      <time datetime="2020-11-17T00:00:00-08:00" itemprop="datePublished">
        
        Nov 17, 2020
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>MusicXML is a standard open format for exchanging digital sheet music, supported by <a href="https://www.musicxml.com/software/" rel="noopener noreferrer" target="_blank">a large number of music applications</a>. Version 3.1 is the first version to be released by the <a href="https://www.w3.org/community/music-notation/" rel="noopener noreferrer" target="_blank">W3C Music Notation Community Group</a>.</p>

<p>It’s a complex format, aiming at capturing both presentation and playback information for a piece of music. That makes it tricky to parse, and tricky to generate. This short note presents a recipe to easily validate MusicXML 3.1 files using open source tools.</p>

<h2 id="musicxml-validation-on-the-console"><a class="header" href="#musicxml-validation-on-the-console">MusicXML validation on the console</a></h2>

<p>MusicXML ships with XSD and DTD files that describe the document structure. We can use the widely-supported tool <code class="language-plaintext highlighter-rouge">xmllint</code> (included in <a href="http://www.xmlsoft.org/" rel="noopener noreferrer" target="_blank">libxml2</a> on most platforms) to validate MusicXML files against the official XSD. As always, a bit of fiddling is needed to get things right <img class="emoji" title=":sweat_smile:" alt=":sweat_smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png" height="20" width="20"></p>

<p>First, download and extract the <a href="https://github.com/w3c/musicxml/releases" rel="noopener noreferrer" target="_blank">latest MusicXML package from W3C’s GitHub</a>. Because the current XSD contains invalid <code class="language-plaintext highlighter-rouge">xs:import</code> links, it is necessary to <a href="https://github.com/w3c/musicxml/pull/284" rel="noopener noreferrer" target="_blank">apply a patch</a> before proceeding with validation. The patch is very simple; you need to change:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;xs:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="http://www.musicxml.org/xsd/xml.xsd"/&gt;
&lt;xs:import namespace="http://www.w3.org/1999/xlink" schemaLocation="http://www.musicxml.org/xsd/xlink.xsd"/&gt;
</code></pre></div></div>
<p>to refer to correct locations, either <code class="language-plaintext highlighter-rouge">w3.org</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;xs:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="http://www.w3.org/2001/xml.xsd"/&gt;
&lt;xs:import namespace="http://www.w3.org/1999/xlink" schemaLocation="http://www.w3.org/1999/xlink.xsd"/&gt;
</code></pre></div></div>
<p>or, since the MusicXML package ships with those files, simply:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;xs:import namespace="http://www.w3.org/XML/1998/namespace" schemaLocation="xml.xsd"/&gt;
&lt;xs:import namespace="http://www.w3.org/1999/xlink" schemaLocation="xlink.xsd"/&gt;
</code></pre></div></div>

<p>You are now ready to use <code class="language-plaintext highlighter-rouge">xmllint</code> to validate your MusicXML files:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout
valid.musicxml validates
$ xmllint --schema musicxml-3.1/schema/musicxml.xsd invalid.musicxml --noout
invalid.musicxml:3: element score-partwise: Schemas validity error : Element 'score-partwise', attribute 'bad-attribute': The attribute 'bad-attribute' is not allowed.
invalid.musicxml fails to validate
</code></pre></div></div>

<p>The difference between local and external links to <code class="language-plaintext highlighter-rouge">xml.xsd</code> and <code class="language-plaintext highlighter-rouge">xlink.xsd</code> is twofold:</p>
<ul>
  <li>The time taken for validation is significant. For local files:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout
valid.musicxml validates

real	0m0.043s
user	0m0.038s
sys	0m0.005s
</code></pre></div></div>
<p>whereas for external files, it takes 15 <em>seconds</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ time xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout
valid.musicxml validates

real	0m15.478s
user	0m0.038s
sys	0m0.005s
</code></pre></div></div>
<ul>
  <li>Secondly, in some environments, it may be necessary to run without an Internet connection, i.e <code class="language-plaintext highlighter-rouge">xmllint --nonet</code>. Here’s what happens in this case:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet
valid.musicxml validates
</code></pre></div></div>
<p>versus</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ xmllint --schema musicxml-3.1/schema/musicxml.xsd valid.musicxml --noout --nonet
I/O error : Attempt to load network entity http://www.w3.org/2001/xml.xsd
warning: failed to load external entity "http://www.w3.org/2001/xml.xsd"
musicxml-3.1/schema/musicxml.xsd:24: element import: Schemas parser warning : Element '{http://www.w3.org/2001/XMLSchema}import': Failed to locate a schema at location 'http://www.w3.org/2001/xml.xsd'. Skipping the import.
I/O error : Attempt to load network entity http://www.w3.org/1999/xlink.xsd
warning: failed to load external entity "http://www.w3.org/1999/xlink.xsd"
musicxml-3.1/schema/musicxml.xsd:25: element import: Schemas parser warning : Element '{http://www.w3.org/2001/XMLSchema}import': Failed to locate a schema at location 'http://www.w3.org/1999/xlink.xsd'. Skipping the import.
[..]
WXS schema musicxml-3.1/schema/musicxml.xsd failed to compile
</code></pre></div></div>

<h2 id="musicxml-validation-programmatically"><a class="header" href="#musicxml-validation-programmatically">MusicXML validation programmatically</a></h2>
<p>If you application exports MusicXML files, it’s a good idea to validate them before processing, to avoid tripping your code or exporting invalid files. On my <a href="https://github.com/infojunkie/ireal-musicxml" rel="noopener noreferrer" target="_blank">iReal Pro to MusicXML converter</a>, I use the JavaScript module <a href="https://www.npmjs.com/package/validate-with-xmllint" rel="noopener noreferrer" target="_blank">validate-with-xmllint</a> in the tests to ensure that the converter module generates valid MusicXML. Since this needs to run at build time, and not on production, I only <a href="https://github.com/infojunkie/ireal-musicxml/blob/c9a08554675efc7eb5be6b0d02243abc19a95afd/.github/workflows/test.yml#L16" rel="noopener noreferrer" target="_blank">need to install <code class="language-plaintext highlighter-rouge">xmllint</code> on the CI server</a>.</p>

<p>But XSD validation is not enough to ensure that your generated XML is valid <em>semantically</em>. It is also necessary to ensure that the expected elements are present, and contain the right values. For this, you need to reach inside your generated XML and compare generated values with your expectations. The easiest and most maintainable way I’ve found for that is using <a href="https://developer.mozilla.org/en-US/docs/Web/XPath" rel="noopener noreferrer" target="_blank">XPath, the XML query language</a>. For this, I use <a href="https://www.npmjs.com/package/xmldom" rel="noopener noreferrer" target="_blank"><code class="language-plaintext highlighter-rouge">xmldom</code></a> and <a href="https://www.npmjs.com/package/xpath.js" rel="noopener noreferrer" target="_blank"><code class="language-plaintext highlighter-rouge">xpath.js</code></a> to <a href="https://github.com/infojunkie/ireal-musicxml/blob/f915531d2b8abef62beebdf72cacde7d555c4f54/test/musicxml.spec.js#L40-L57" rel="noopener noreferrer" target="_blank">validate the generated MusicXML files during the test phase</a>.</p>

<p>That’s it! Hope you find this useful <img class="emoji" title=":raised_hands:" alt=":raised_hands:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f64c.png" height="20" width="20"></p>

  </div>

  

  
    
<script data-isso="https://blog.karimratib.me/isso" src="https://blog.karimratib.me/isso/js/embed.min.js"></script>
<section id="isso-thread"></section>


  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">infojunkie</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            <a href="/assets/CV-KarimRATIB.pdf">
              my resume
            </a>
          </li>
          <li>
            <a href="https://github.com/infojunkie/blog" rel="noopener noreferrer" target="_blank">
              blog source
            </a>
          </li>
        </ul>

        <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>

      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://thereisamoduleforthat.com" rel="noopener noreferrer" target="_blank">
              <img src="/assets/tmft.svg">
              There's a module for that!
            </a>
          </li>
          <li>
            <a href="https://github.com/infojunkie" rel="noopener noreferrer" target="_blank">
              <svg class="icon"><use xlink:href="#fab.fa-github"></use></svg>
              GitHub
            </a>
          </li>
          <li>
            <a href="https://www.youtube.com/@KarimRatib" rel="noopener noreferrer" target="_blank">
              <svg class="icon"><use xlink:href="#fab.fa-youtube"></use></svg>
              YouTube
            </a>
          </li>
          <li>
            <a href="https://musescore.com/infojunkie" rel="noopener noreferrer" target="_blank">
              <svg class="icon"><use xlink:href="#fas.fa-music"></use></svg>
              MuseScore
            </a>
          </li>
          <li>
            <a href="mailto:karim.ratib@gmail.com">
              <svg class="icon"><use xlink:href="#far.fa-envelope"></use></svg>
              email
            </a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
      </div>
    </div>

    <div class="footer-col">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a><br>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    </div>

  </div>

  <svg display="none" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <defs>
                  <!--
                  Font Awesome Free 5.5.0 by @fontawesome - https://fontawesome.com
                  License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
                  -->
              <symbol id="fab.fa-github" viewbox="0 0 496 512">
            <title>github</title>
            <path class="path1" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
        </symbol>
        <symbol id="fab.fa-youtube" viewbox="0 0 576 512">
            <title>youtube</title>
            <path class="path1" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path>
        </symbol>
        <symbol id="fas.fa-music" viewbox="0 0 512 512">
            <title>music</title>
            <path class="path1" d="M499.1 6.3c8.1 6 12.9 15.6 12.9 25.7v72V368c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6V147L192 223.8V432c0 44.2-43 80-96 80s-96-35.8-96-80s43-80 96-80c11.2 0 22 1.6 32 4.6V200 128c0-14.1 9.3-26.6 22.8-30.7l320-96c9.7-2.9 20.2-1.1 28.3 5z"></path>
        </symbol>
        <symbol id="far.fa-envelope" viewbox="0 0 512 512">
            <title>envelope</title>
            <path class="path1" d="M64 112c-8.8 0-16 7.2-16 16v22.1L220.5 291.7c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16H64zM48 212.2V384c0 8.8 7.2 16 16 16H448c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64H448c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"></path>
        </symbol>
        </defs>
              </svg>

</footer>


  </body>

</html>
